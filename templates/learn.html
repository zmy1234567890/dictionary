<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>èƒŒå•è¯ç³»ç»Ÿ - å­¦ä¹ </title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/learn.css') }}">
</head>

<body>
    <div class="container">

        <h2>ğŸ“˜ å¼€å§‹å­¦ä¹ </h2>

        {% if words|length > 0 %}
        <div>
            <span id="progress"
                style="font-weight: bold; font-size: 16px; margin-bottom: 10px; display: inline-block;"></span>
        </div>

        <div class="card" id="word-card">
            <div class="word-large" id="word-text"></div>
            <div class="translation" id="word-translation"></div>
            <ul class="examples" id="word-examples"></ul>
        </div>

        <div class="nav-buttons" style="margin-top: 10px;">
            <button id="prev-word">ä¸Šä¸€ä¸ª</button>
            <button id="next-word">ä¸‹ä¸€ä¸ª</button>
        </div>

        <form method="post" id="mark-form" style="margin-top: 10px;">
            <input type="hidden" name="word" id="mark-word" value="">
            <input type="hidden" name="level" id="mark-level" value="">
            <input type="hidden" name="index" id="mark-index" value="">
            <div class="btn-group" style="margin-top: 10px;">
                <button type="button" onclick="markWord(1)">å·²æŒæ¡</button>
                <button type="button" onclick="markWord(0)">æ¨¡ç³Š</button>
                <button type="button" onclick="markWord(-1)">ä¸è®¤è¯†</button>
            </div>
        </form>

        {% else %}
        <p>ğŸ‰ å·²å®Œæˆå½“å‰è¯åº“æ‰€æœ‰å•è¯çš„å­¦ä¹ ï¼</p>
        {% endif %}

        {% if today_learned_count is not none and daily_count is not none %}
        <p style="
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 10px;
            {% if today_learned_count < daily_count %}
                color: red;
            {% else %}
                color: green;
            {% endif %}
        ">
            ä»Šæ—¥å­¦ä¹ : {{ today_learned_count }} / {{ daily_count }}
            {% if today_learned_count >= daily_count %}
            ï¼Œæ­å–œä½ å®Œæˆä»Šæ—¥å­¦ä¹ ï¼
            {% endif %}
        </p>
        {% endif %}

        <a href="{{ url_for('home') }}" class="back-link">â† è¿”å›é¦–é¡µ</a>
    </div>

    <script>
        const words = {{ words | tojson | safe }};
        const totalWords = {{ total }};

        let currentIndex = 0;

        function showWord(index) {
            if (words.length === 0) return;

            if (index < 0) index = words.length - 1;
            if (index >= words.length) index = 0;
            currentIndex = index;

            const w = words[index];
            document.getElementById("word-text").textContent = w.word;
            document.getElementById("word-translation").textContent = w.translation;

            const exList = document.getElementById("word-examples");
            exList.innerHTML = "";
            if (w.examples && w.examples.length > 0) {
                for (let ex of w.examples) {
                    const li = document.createElement("li");
                    if (typeof ex === "string") {
                        li.textContent = ex;
                    } else {
                        li.innerHTML = ex.en + "<br>" + ex.cn;
                    }
                    exList.appendChild(li);
                }
            }

            const globalIndex = currentIndex + 1;
            document.getElementById("progress").textContent = `${globalIndex} / ${totalWords}`;

            // æ›´æ–°éšè—è¡¨å•ï¼Œç”¨äºPOST
            document.getElementById("mark-word").value = w.word;
            document.getElementById("mark-level").value = "";
            document.getElementById("mark-index").value = currentIndex;
        }

        document.getElementById("prev-word").addEventListener("click", () => {
            showWord(currentIndex - 1);
        });

        document.getElementById("next-word").addEventListener("click", () => {
            showWord(currentIndex + 1);
        });

        function markWord(level) {
            if (words.length === 0) return;
            document.getElementById("mark-level").value = level;
            document.getElementById("mark-form").submit();
        }

        showWord(currentIndex);
    </script>


    <button id="help-button" onclick="toggleHelpCard()">?</button>

    <!-- å¡ç‰‡å†…å®¹ -->
    <div id="help-card"
        style="display: none; position: absolute; top: 60px; right: 20px; width: 320px;
                border: 1px solid #ccc; padding: 15px; border-radius: 8px;
                background: #fefefe; box-shadow: 0 2px 8px rgba(0,0,0,0.15); z-index: 1000; font-size: 0.95em; line-height: 1.5;">
        <p style="margin: 0 0 10px 0; font-weight: bold; font-size: 1.1em;">å¸®åŠ©</p>

        <p>å­¦ä¹ é¡µé¢å…è®¸ç”¨æˆ·æµè§ˆå•è¯å¡ç‰‡ï¼ˆæ˜¾ç¤ºå•è¯ã€é‡Šä¹‰å’Œä¾‹å¥ï¼‰ï¼Œé€šè¿‡"ä¸Šä¸€ä¸ª/ä¸‹ä¸€ä¸ª"æŒ‰é’®å¯¼èˆªï¼Œç”¨ä¸‰ä¸ªæŒ‰é’®æ ‡è®°æŒæ¡ç¨‹åº¦ï¼ˆå·²æŒæ¡/æ¨¡ç³Š/ä¸è®¤è¯†ï¼‰ã€‚å¯¹æŸä¸ªå•è¯è¿›è¡Œæ ‡è®°åï¼Œå•è¯å°†ç§»å‡ºå­¦ä¹ åˆ—è¡¨ã€‚é¡¶éƒ¨æ˜¾ç¤ºå­¦ä¹ è¿›åº¦å’Œä»Šæ—¥ä»»åŠ¡å®Œæˆæƒ…å†µã€‚</p>

        <p style="margin-top: 12px; font-weight: bold;">å•è¯åˆ†ç±»:</p>
        <ul style="padding-left: 18px; margin: 6px 0;">
            <li><strong>å·²æŒæ¡</strong>ï¼šç”¨æˆ·å·²è®¤è¯†çš„å•è¯ï¼Œä¸ä¼šå‡ºç°åœ¨å¤ä¹ åˆ—è¡¨ä¸­ã€‚</li>
            <li><strong>æ¨¡ç³Š</strong>ï¼šç”¨æˆ·å¯èƒ½è§è¿‡çš„å•è¯ï¼ŒæŒ‰ä¸­ç­‰é¢‘ç‡è¿›è¡Œå¤ä¹ ã€‚</li>
            <li><strong>ä¸è®¤è¯†</strong>ï¼šç”¨æˆ·æ–°è®¤è¯†çš„å•è¯ï¼ŒæŒ‰é«˜é¢‘ç‡è¿›è¡Œå¤ä¹ ã€‚</li>
        </ul>
    </div>


    <script>
        function toggleHelpCard() {
            const card = document.getElementById("help-card");
            card.style.display = (card.style.display === "none" || card.style.display === "") ? "block" : "none";
        }
    </script>


</body>

</html>